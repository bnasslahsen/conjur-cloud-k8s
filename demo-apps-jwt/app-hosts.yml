# conjur policy update -f app-hosts.yml -b data/bnl
- !policy
  id: $K8S_PLATFORM-apps
  owner: !group ocp-team/managers
  body:
    - &hosts
      - !host 
        id: demo-app-api-key
        annotations:
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-jwt-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-jwt-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-secrets-provider-init-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-secrets-provider-init-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-secrets-provider-sidecar-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-secrets-provider-sidecar-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-push-to-file-sidecar-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-push-to-file-sidecar-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-summon-init-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-summon-init-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-summon-sidecar-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-summon-sidecar-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-app-secretless-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-app-secretless-sa
          authn/api-key: true
      - !host
        id: system:serviceaccount:$APP_NAMESPACE:demo-db-mysql-sa
        annotations:
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/namespace: $APP_NAMESPACE
          authn-jwt/$CONJUR_AUTHENTICATOR_ID/kubernetes.io/serviceaccount/name: demo-db-mysql-sa
          authn/api-key: true
    - !grant
      role: !group
      members: *hosts

